"use strict";!function($){function limits(value,min,max,unit){if("string"==typeof value&&"string"==typeof min&&"string"==typeof max&&unit){var Value=Number(value.split(unit)[0]),Min=Number(min.split(unit)[0]),Max=Number(max.split(unit)[0]),res;return String(Value<Min?Min:Value>Max?Max:Value)+unit}if("number"==typeof value)return value<min?min:value>max?max:value}function Smilebar(Ele,config){var _this=this;this.config={type:"xy",size:"12px",color:"#252a35",silderSize:"60%",silderColor:"#404550",clickBln:!0,keyBln:!0,keySpeed:1,wheelBln:!0,wheelSpeed:1,handBln:!1,handSpeed:30,initPosition:{x:0,y:0}},this.config=$.extend({},this.config,config),this.config.silderSize=limits(this.config.silderSize,"20%","100%","%"),this.init(Ele),this.checkScrollbar(),this.monitorContent(),this.moving(this.config.initPosition),this.bind()}Smilebar.prototype.init=function(Ele){var _this=this;switch(this.container=null,this.content=null,this.sliderY=null,this.scrollbarY=null,this.sliderX=null,this.scrollbarX=null,this.cross=null,this.sliders=null,this.containerWidth=0,this.containerHeight=0,this.contentWidth=0,this.contentHeight=0,this.trackY=0,this.lenY=0,this.moveTop=0,this.diffY=0,this.trackX=0,this.lenX=0,this.moveLeft=0,this.diffX=0,this.createScrollEle(Ele),this.config.type){case"x":this.container.prepend(this.scrollbarX);break;case"y":this.container.prepend(this.scrollbarY);break;default:this.container.prepend(this.scrollbarX,this.scrollbarY,this.cross)}this.config.clickBln||"true"==this.container.attr("data-click")?this.scrollbars.css({cursor:"pointer"}):this.scrollbars.css({cursor:""}),this.config.handBln||"true"==this.container.attr("data-hand")?this.container.css({cursor:"url('smilebarImg/grasp.png'),auto"}):this.container.css({cursor:""}),(this.config.keyBln||"true"==this.container.attr("data-key"))&&(Smilebar.prototype.keyTotal+=1)},Smilebar.prototype.bind=function(){var doc=$(window.document),_this=this;_this.bindEvent(_this.scrollbars,"click",(function(event){var e=event||window.event;if(e.target!==_this.sliderX[0]&&e.target!==_this.sliderY[0]&&(_this.config.clickBln||"true"==_this.container.attr("data-click"))){_this.clicked=e.target===_this.scrollbarX[0]?"x":"y";var X=e.pageX,Y=e.pageY,Top=_this.scrollbarY.offset().top,Left=_this.scrollbarX.offset().left;switch(_this.clicked){case"x":var X_diff,X_left=(X-Left)/_this.trackX*_this.moveLeft;_this.moveScorollbar(X_left,_this.clicked);break;case"y":var Y_diff,Y_top=(Y-Top)/_this.trackY*_this.moveTop;_this.moveScorollbar(Y_top,_this.clicked)}}})),_this.bindEvent(_this.sliders,"mousedown",(function(event){var _this=this,e=event||window.event;_this.pressed=e.target===_this.sliderX[0]?"x":"y";var X=e.pageX,Y=e.pageY,Top=_this.sliderY.position().top,Left=_this.sliderX.position().left;_this.bindEvent(doc,"mousemove",(function(event){var e=event||window.event;switch(_this.pressed){case"x":var X_diff=e.pageX-X,X_left=Left+X_diff;_this.moveScorollbar(X_left,_this.pressed);break;case"y":var Y_diff=e.pageY-Y,Y_top=Top+Y_diff;_this.moveScorollbar(Y_top,_this.pressed)}})),_this.bindEvent(doc,"selectstart",(function(event){var e;(event||window.event).preventDefault()}))})),_this.bindEvent(_this.container,"mousedown",(function(event){var e=event||window.event;if((_this.config.handBln||"true"==_this.container.attr("data-hand"))&&e.target!==_this.sliderX[0]&&e.target!==_this.sliderY[0]){_this.container.css({cursor:"url('smilebarImg/grasp_active.png'),auto"});var X=e.pageX,Y=e.pageY,Top=_this.sliderY.position().top,Left=_this.sliderX.position().left;_this.bindEvent(doc,"mousemove",(function(event){var e=event||window.event,X_diff=-(e.pageX-X),Y_diff,addY=-(e.pageY-Y)*_this.config.handSpeed/100,Y_top=Top+addY,addX=X_diff*_this.config.handSpeed/100,X_left=Left+addX;switch(_this.config.type){case"x":_this.moveScorollbar(X_left,"x");break;case"y":_this.moveScorollbar(Y_top,"y");break;default:_this.moveScorollbar(X_left,"x"),_this.moveScorollbar(Y_top,"y")}})),_this.bindEvent(doc,"selectstart",(function(event){var e;(event||window.event).preventDefault()}))}})),_this.bindEvent(doc,"mouseup",(function(){_this.pressed=-1,_this.config.handBln||"true"==_this.container.attr("data-hand")?_this.container.css({cursor:"url('smilebarImg/grasp.png'),auto"}):_this.container.css({cursor:""}),doc.unbind("mousemove"),doc.unbind("selectstart")})),1==_this.keyTotal&&_this.bindEvent(doc,"keydown",(function(event){var e=event||window.event;if(_this.config.keyBln||"true"==_this.container.attr("data-key")){var Top=_this.sliderY.position().top,Left=_this.sliderX.position().left;switch(e.keyCode){case 38:if("x"==_this.config.type)return;var moveY,Y_top=Top-(moveY=_this.trackY*_this.config.keySpeed/100);_this.moveScorollbar(Y_top,"y");break;case 40:if("x"==_this.config.type)return;var moveY,Y_top=Top+(moveY=_this.trackY*_this.config.keySpeed/100);_this.moveScorollbar(Y_top,"y");break;case 37:if("y"==_this.config.type)return;var moveX,X_left=Left-(moveX=_this.trackX*_this.config.keySpeed/100);_this.moveScorollbar(X_left,"x");break;case 39:if("y"==_this.config.type)return;var moveX,X_left=Left+(moveX=_this.trackX*_this.config.keySpeed/100);_this.moveScorollbar(X_left,"x")}}})),_this.bindEvent(_this.container,"mousewheel DOMMouseScroll",(function(event){var e=event||window.event;if(e.stopPropagation(),e.preventDefault(),(_this.config.wheelBln||"true"==_this.container.attr("data-wheel"))&&"x"!==_this.config.type){var Top=_this.sliderY.position().top,wheel;if((e.originalEvent.wheelDelta||-e.originalEvent.detail)<0){var moveY,Y_top=Top+(moveY=_this.trackY*_this.config.wheelSpeed/100);_this.moveScorollbar(Y_top,"y")}else{var moveY,Y_top=Top-(moveY=_this.trackY*_this.config.wheelSpeed/100);_this.moveScorollbar(Y_top,"y")}}}))},Smilebar.prototype.moveScorollbar=function(move,type){var _this=this;switch(this.config.type){case"x":if("y"===type)return;var moving=limits(move,0,this.moveLeft);this.sliderX.css({left:moving+"px"});var content_diffX=this.diffX,content_X=Math.round(moving/this.moveLeft*content_diffX);this.content.css({left:"-"+content_X+"px"});break;case"y":if("x"===type)return;var moving=limits(move,0,this.moveTop);this.sliderY.css({top:moving+"px"});var content_diffY=this.diffY,content_Y=Math.round(moving/this.moveTop*content_diffY);this.content.css({top:"-"+content_Y+"px"});break;default:if("x"===type){var moving=limits(move,0,this.moveLeft);this.sliderX.css({left:moving+"px"});var content_diffX="none"===this.scrollbarY.css("display")?this.diffX:this.diffX+this.scrollbarY.width(),content_X=Math.round(moving/this.moveLeft*content_diffX);this.content.css({left:"-"+content_X+"px"})}if("y"===type){var moving=limits(move,0,this.moveTop);this.sliderY.css({top:moving+"px"});var content_diffY="none"===this.scrollbarX.css("display")?this.diffY:this.diffY+this.scrollbarX.height(),content_Y=Math.round(moving/this.moveTop*content_diffY);this.content.css({top:"-"+content_Y+"px"})}}},Smilebar.prototype.moving=function(position){var _this=this;if(null!=position.x){var typeX=typeof position.x;if("number"==typeX)this.moveScorollbar(position.x,"x");else if("string"==typeX){var X_left;switch(position.x){case"first":X_left=0;break;case"center":X_left=this.percentToNumber("50%","x");break;case"last":X_left=this.moveLeft;break;default:X_left=this.percentToNumber(position.x,"x")}this.moveScorollbar(X_left,"x")}}if(null!=position.y){var typeY=typeof position.y;if("number"==typeY)this.moveScorollbar(position.y,"y");else if("string"==typeY){var Y_top;switch(position.y){case"first":Y_top=0;break;case"center":Y_top=this.percentToNumber("50%","y");break;case"last":Y_top=this.moveTop;break;default:Y_top=this.percentToNumber(position.x,"y")}this.moveScorollbar(Y_top,"y")}}},Smilebar.prototype.createScrollEle=function(Ele){var _this=this;this.container=$(Ele).css({position:"relative",overflow:"hidden"}),this.container.contents().wrapAll($("<div/>",{class:"smilebar-content"})),this.content=this.container.find(".smilebar-content"),this.sliderY=$("<div/>",{class:"smilebar-slider"}).css({width:this.config.silderSize,background:this.config.silderColor}),this.scrollbarY=$("<div/>",{class:"smilebar-scrollbar smilebar-scrollbarY"}).css({width:this.config.size,background:this.config.color}),this.sliderX=$("<div/>",{class:"smilebar-slider"}).css({height:this.config.silderSize,background:this.config.silderColor}),this.scrollbarX=$("<div/>",{class:"smilebar-scrollbar smilebar-scrollbarX"}).css({height:this.config.size,background:this.config.color}),this.cross=$("<div class='smilerbar-cross'></div>").css({width:this.config.size,height:this.config.size,background:this.config.color}),this.sliders=this.sliderY.add(this.sliderX),this.scrollbars=this.scrollbarY.add(this.scrollbarX),this.scrollbarY.append(this.sliderY),this.scrollbarX.append(this.sliderX)},Smilebar.prototype.checkScrollbar=function(){var _this=this;switch(this.containerWidth=this.container.width(),this.containerHeight=this.container.height(),this.contentWidth=this.content.width(),this.contentHeight=this.content.height(),this.diffX=this.content.width()-this.container.width(),this.diffY=this.content.height()-this.container.height(),this.config.type){case"x":this.trackX=this.containerWidth,this.diffX>0?(this.lenX=(this.containerWidth/this.contentWidth).toFixed(2),this.sliderX.css({width:100*this.lenX+"%"}),this.scrollbarX.show(),this.moveLeft=this.trackX-this.sliderX.width()):(this.scrollbarX.hide(),this.lenX=0,this.moveLeft=0);break;case"y":this.trackY=this.containerHeight,this.diffY>0?(this.lenY=(this.containerHeight/this.contentHeight).toFixed(2),this.sliderY.css({height:100*this.lenY+"%"}),this.scrollbarY.show(),this.moveTop=this.trackY-this.sliderY.height()):(this.scrollbarY.hide(),this.lenY=0,this.moveTop=0);break;default:var crossW=this.cross.width(),crossH=this.cross.height(),Y_diff;if(this.diffX<0&&this.diffY<0)this.scrollbarX.hide(),this.scrollbarY.hide(),this.lenY=0,this.lenX=0,this.moveTop=0,this.moveLeft=0;else if(this.diffX>0)this.diffY+this.scrollbarX.height()>0?(this.lenX=(this.containerWidth/this.contentWidth).toFixed(2),this.sliderX.css({width:100*this.lenX+"%"}),this.lenY=(this.containerHeight/this.contentHeight).toFixed(2),this.sliderY.css({height:100*this.lenY+"%"}),this.scrollbarX.show(),this.scrollbarY.show(),this.cross.show(),this.trackX=this.containerWidth-crossW,this.trackY=this.containerHeight-crossH,this.moveTop=this.trackY-this.sliderY.height(),this.moveLeft=this.trackX-this.sliderX.width()):(this.lenX=(this.containerWidth/this.contentWidth).toFixed(2),this.sliderX.css({width:100*this.lenX+"%"}),this.scrollbarX.show(),this.scrollbarY.hide(),this.cross.hide(),this.lenY=0,this.trackX=this.containerWidth,this.trackY=0,this.moveLeft=this.trackX-this.sliderX.width(),this.moveTop=0);else if(this.diffY>0){var X_diff;this.diffX+this.sliderY.width()>0?(this.lenX=(this.containerWidth/this.contentWidth).toFixed(2),this.sliderX.css({width:100*this.lenX+"%"}),this.lenY=(this.containerHeight/this.contentHeight).toFixed(2),this.sliderY.css({height:100*this.lenY+"%"}),this.scrollbarX.show(),this.scrollbarY.show(),this.cross.show(),this.trackX=this.containerWidth-crossW,this.trackY=this.containerHeight-crossH,this.moveTop=this.trackY-this.sliderY.height(),this.moveLeft=this.trackX-this.sliderX.width()):(this.lenY=(this.containerHeight/this.contentHeight).toFixed(2),this.sliderY.css({height:100*this.lenY+"%"}),this.scrollbarY.show(),this.scrollbarX.hide(),this.cross.hide(),this.lenX=0,this.trackY=this.containerHeight,this.trackX=0,this.moveTop=this.trackY-this.sliderY.height(),this.moveLeft=0)}}},Smilebar.prototype.monitorContent=function(){var _this=this;_this.timer=setInterval(function(){var diffW=_this.content.width()-_this.contentWidth,diffH=_this.content.height()-_this.contentHeight;if("y"==_this.config.type){if(!diffH)return;_this.checkScrollbar()}else if("x"==_this.config.type){if(!diffW)return;_this.checkScrollbar()}else{if(!diffW&&!diffH)return;_this.checkScrollbar()}}.bind(_this),200)},Smilebar.prototype.applyFun=function(cb){var _this=this;return function(){cb.apply(_this,Array.prototype.slice.call(arguments))}},Smilebar.prototype.bindEvent=function(Ele,event,cb){var _this=this;return Ele.on(event,this.applyFun(cb))},Smilebar.prototype.percentToNumber=function(value,type){var _this=this,result=0,res=Number(value.split("%")[0]);return res=isNaN(res)?0:res,"x"==type?result=this.trackX*res/100-this.sliderX.width()/2:"y"==type&&(result=this.trackY*res/100-this.sliderY.height()/2),result},Smilebar.prototype.update=function(position){var _this=this;this.config.initPosition=position||this.config.initPosition,this.checkScrollbar(),this.moving(this.config.initPosition)},Smilebar.prototype.keyTotal=0,$.fn.smilebar=function(config){return new Smilebar(this,config)}}(jQuery);